# Расшифровка GOE (Grade of Execution) в XML файлах ISUCalcFS

## Общая информация

GOE (Grade of Execution) - это оценка качества исполнения элемента в фигурном катании. Шкала GOE всегда от **-5 до +5**, где:
- **-5** - очень плохое исполнение (падение, серьезные ошибки)
- **0** - среднее исполнение (базовая стоимость элемента)
- **+5** - превосходное исполнение (отличное качество)

## Кодирование GOE в XML

В XML файлах ISUCalcFS GOE кодируется числами от 0 до 15. Каждый код соответствует определенному значению GOE.

### Таблица расшифровки

| Код в XML | Значение GOE | Описание |
|-----------|--------------|----------|
| **0** | **-5** | Очень плохое исполнение |
| **1** | **-4** | Плохое исполнение |
| **2** | **-3** | Ниже среднего |
| **3** | **-2** | Немного ниже среднего |
| **4** | **-1** | Чуть ниже среднего |
| **5** | **0** | Среднее (базовая стоимость) |
| **6** | **+1** | Чуть выше среднего |
| **7** | **+2** | Немного выше среднего |
| **8** | **+3** | Хорошее исполнение |
| **9** | **None** | Не используется / Пусто |
| **10** | **-5** | Специальный случай (снятие) |
| **11** | **-5** | Альтернативное кодирование -5 |
| **12** | **-4** | Альтернативное кодирование -4 |
| **13** | **-3** | Альтернативное кодирование -3 |
| **14** | **-2** | Альтернативное кодирование -2 |
| **15** | **-1** | Альтернативное кодирование -1 |

## Формула преобразования

### Python реализация

```python
def decode_goe_xml(code):
    """Расшифровка кода GOE из XML в значение (-5..+3)."""
    if code is None:
        return None
    
    code = str(code).strip()
    if not code or code == '9':
        return None
    
    try:
        code_int = int(code)
    except ValueError:
        return None
    
    # Код 9 - не используется
    if code_int == 9:
        return None
    
    # Код 10 - специальный случай (-5)
    if code_int == 10:
        return -5
    
    # Коды 0-8: стандартное кодирование
    if 0 <= code_int <= 8:
        return code_int - 5  # 0→-5, 1→-4, 2→-3, 3→-2, 4→-1, 5→0, 6→+1, 7→+2, 8→+3
    
    # Коды 11-15: альтернативное кодирование для отрицательных значений
    if 11 <= code_int <= 15:
        return code_int - 16  # 11→-5, 12→-4, 13→-3, 14→-2, 15→-1
    
    return None
```

## Примеры из XML

### Пример 1: Элемент с кодом 11 (GOE = -5)
```xml
<Performance PRF_E01J01="11" PRF_E01J02="11" PRF_E01J03="11"/>
```
**Результат:** J1=-5, J2=-5, J3=-5

### Пример 2: Элемент с кодом 12 (GOE = -4)
```xml
<Performance PRF_E02J01="12" PRF_E02J02="11" PRF_E02J03="11"/>
```
**Результат:** J1=-4, J2=-5, J3=-5

### Пример 3: Элемент с кодом 2 (GOE = -3)
```xml
<Performance PRF_E03J01="2" PRF_E03J02="2" PRF_E03J03="2"/>
```
**Результат:** J1=-3, J2=-3, J3=-3

### Пример 4: Элемент с кодом 4 (GOE = -1)
```xml
<Performance PRF_E04J01="4" PRF_E04J02="3" PRF_E04J03="4"/>
```
**Результат:** J1=-1, J2=-2, J3=-1

## Расположение в XML

GOE коды хранятся в атрибутах элементов `Performance` в следующем формате:
- `PRF_E{idx}J{jidx}` - где:
  - `{idx}` - номер элемента (01-20)
  - `{jidx}` - номер судьи (01-15)

**Пример:**
```xml
<Performance 
    PRF_E01J01="11"  <!-- Элемент 1, Судья 1: GOE = -5 -->
    PRF_E01J02="11"  <!-- Элемент 1, Судья 2: GOE = -5 -->
    PRF_E01J03="11"  <!-- Элемент 1, Судья 3: GOE = -5 -->
/>
```

## Важные замечания

1. **Коды 0-8** - основная шкала GOE от -5 до +3
2. **Код 9** - не используется, означает отсутствие оценки
3. **Код 10** - специальный случай для -5 (обычно используется при снятии)
4. **Коды 11-15** - альтернативное кодирование для отрицательных значений (-5 до -1)
5. **Положительные значения выше +3** в стандартной кодировке не используются (коды 6-8 дают +1, +2, +3)

## Использование в проекте

Функция расшифровки GOE находится в файле:
- `parsers/isu_calcfs_parser.py` - метод `_decode_goe_xml()`

Эта функция используется при парсинге XML файлов для преобразования кодов GOE из XML в числовые значения для хранения в базе данных.

## История изменений

- **2026-01-25**: Исправлена формула для кодов 11-15 (было `code_int - 10`, стало `code_int - 16`)
